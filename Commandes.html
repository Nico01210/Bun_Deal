<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commandes</title>
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüçî%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüçî%3C/text%3E%3C/svg%3E">
    
    <link rel="stylesheet" href="style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

</head>
<body class="other-page">

<!-- Overlay pour fermer le menu mobile -->
<div class="nav-overlay"></div>

<!-- Navbar avec menu burger -->
<nav class="menu">
  <div class="navbar-container">
    <a href="/Bun_Deal/index.html" class="logo">
      <img src="images/Logo.png" alt="Logo Bun'Deal" class="logo-navbar">
    </a>
    
    <!-- Menu burger -->
    <div class="burger-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
    
    <!-- Navigation links -->
    <ul class="nav-links">
      <li><a href="/Bun_Deal/index.html" data-translate="nav.home">Accueil</a></li>
      <li><a href="/Bun_Deal/apropos.html" data-translate="nav.about">A propos</a></li>
      <li><a href="/Bun_Deal/menu.html" data-translate="nav.menu">Menu</a></li>
      <li><a href="/Bun_Deal/Contact.html" data-translate="nav.contact">Contact</a></li>
      <li><a href="#" id="open-cart" style="font-weight:bold;">üõí <span data-translate="nav.cart">Panier</span> (<span id="cart-count">0</span>)</a></li>
      <li>
        <button id="lang-toggle" class="btn btn-outline-light btn-sm">
          <img src="images/flag-en.svg" alt="English" style="width: 16px; height: 12px; margin-right: 4px;">
          EN
        </button>
      </li>
    </ul>
  </div>
</nav>

<!-- Contenu principal -->
<div class="commande-bg py-5">
  <div class="container" style="max-width: 700px;">
    <h2 class="commande-title text-center mb-4" data-translate="commandes.title">Finalisation de la commande</h2>
    <div id="contenu-commande" class="commande-card p-4 rounded-4 shadow-lg bg-white">
      <p class="mb-3 fs-5" data-translate="commandes.summary">Voici le <span class="fw-bold text-primary">r√©capitulatif</span> de votre commande :</p>
      <div id="panier-container"></div>
      <div id="panier-total" class="fw-bold my-3 fs-5"></div>
      <button id="confirmer-commande" class="btn btn-success w-100 py-2 fs-5 mt-2" data-translate="commandes.confirm_button">Confirmer ma commande</button>
    </div>
    <div id="confirmation" style="display: none; margin-top: 30px;"></div>
  </div>
</div>

<!-- Modal panier -->
<div class="modal" tabindex="-1" id="cart-modal">
  <div style="background:#fff; margin:5% auto; padding:20px; max-width:500px; border-radius:8px; position:relative;">
    <h4 data-translate="modals.cart.title">Votre panier</h4>
    <ul id="cart-items" style="list-style:none; padding:0;"></ul>
    <p><span data-translate="modals.cart.total">Total</span> : <span id="cart-total">0.00</span> ‚Ç¨</p>
    <div class="d-flex justify-content-between gap-2 mt-3">
      <button class="btn btn-danger flex-fill" id="clear-cart" data-translate="modals.cart.clear">Vider le panier</button>
      <button class="btn btn-success flex-fill" id="validate-cart" data-translate="modals.cart.validate">Valider le panier</button>
      <button class="btn btn-secondary flex-fill" id="close-cart" data-translate="modals.cart.close">Fermer</button>
    </div>
  </div>
</div>

<style>
/* Style sp√©cifique √† la page Commandes */
.commande-bg {
  background: linear-gradient(120deg, #f8fafc 60%, #e6f0fa 100%);
  min-height: 100vh;
}
.commande-title {
  font-family: 'Montserrat', Arial, sans-serif;
  font-weight: 700;
  color: #10222e;
  letter-spacing: 1px;
}
.commande-card {
  border: 2px solid #10222e;
  background: #fff;
  box-shadow: 0 8px 32px rgba(16,34,46,0.08);
}
#panier-container table {
  background: #f8f9fa;
  border-radius: 12px;
  overflow: hidden;
}
#panier-container th {
  background: #10222e;
  color: #fff;
  font-weight: 600;
  text-align: center;
}
#panier-container td {
  text-align: center;
  vertical-align: middle;
}
#panier-total span {
  font-size: 1.3em;
  font-weight: bold;
}
#confirmer-commande {
  box-shadow: 0 2px 8px rgba(25,135,84,0.08);
  font-size: 1.1em;
  letter-spacing: 0.5px;
}
#confirmation .card {
  border-radius: 18px;
  border-width: 2.5px;
}
@media (max-width: 600px) {
  .commande-card, .container { padding: 10px !important; }
  .commande-title { font-size: 1.3rem; }
  #panier-container table { font-size: 0.95em; }
}
</style>

<!-- Ton script JS directement dans la page -->
<script>
// Script de traduction
let currentLang = localStorage.getItem('language') || 'fr';
let translations = {};

// Charge les traductions
async function loadTranslations() {
  try {
    const response = await fetch('translations.json');
    translations = await response.json();
    updateLanguage();
  } catch (error) {
    console.error('Erreur lors du chargement des traductions:', error);
  }
}

// Met √† jour tous les textes selon la langue
function updateLanguage() {
  const langButton = document.getElementById('lang-toggle');
  
  // Met √† jour le bouton de langue avec les drapeaux
  if (currentLang === 'fr') {
    langButton.innerHTML = '<img src="images/flag-en.svg" alt="English" style="width: 16px; height: 12px; margin-right: 4px;"> EN';
  } else {
    langButton.innerHTML = '<img src="images/flag-fr.svg" alt="Fran√ßais" style="width: 16px; height: 12px; margin-right: 4px;"> FR';
  }
  
  // Met √† jour tous les √©l√©ments avec data-translate
  document.querySelectorAll('[data-translate]').forEach(element => {
    const key = element.getAttribute('data-translate');
    const text = getTranslation(key);
    if (text) {
      element.textContent = text;
    }
  });
  
  // Met √† jour le contenu du panier si affich√©
  updateCommandeDisplay();
}

// R√©cup√®re une traduction par cl√©
function getTranslation(key) {
  const keys = key.split('.');
  let value = translations[currentLang];
  
  for (const k of keys) {
    if (value && value[k]) {
      value = value[k];
    } else {
      return null;
    }
  }
  
  return value;
}

// Gestion du changement de langue
document.addEventListener('DOMContentLoaded', function() {
  loadTranslations();
  
  const langToggle = document.getElementById('lang-toggle');
  if (langToggle) {
    langToggle.addEventListener('click', function() {
      currentLang = currentLang === 'fr' ? 'en' : 'fr';
      localStorage.setItem('language', currentLang);
      updateLanguage();
    });
  }
});

// Met √† jour l'affichage de la commande avec traduction
function updateCommandeDisplay() {
  const panier = JSON.parse(localStorage.getItem("cart")) || [];
  const container = document.getElementById("panier-container");
  const totalDiv = document.getElementById("panier-total");
  
  if (panier.length === 0) {
    container.innerHTML = `<p>${getTranslation('commandes.empty_cart') || 'Votre panier est vide.'}</p>`;
    document.getElementById("confirmer-commande").style.display = "none";
    totalDiv.innerHTML = "";
  } else {
    let total = 0;
    container.innerHTML = `
      <table class='table table-bordered'>
        <thead><tr>
          <th>${getTranslation('commandes.table.product') || 'Produit'}</th>
          <th>${getTranslation('commandes.table.quantity') || 'Quantit√©'}</th>
          <th>${getTranslation('commandes.table.price') || 'Prix unitaire'}</th>
          <th>${getTranslation('commandes.table.total') || 'Sous-total'}</th>
        </tr></thead>
        <tbody>
          ${panier.map(p => {
            const sousTotal = (p.price * p.qty).toFixed(2);
            total += parseFloat(sousTotal);
            return `<tr><td>${p.name}</td><td>${p.qty}</td><td>${p.price.toFixed(2)}‚Ç¨</td><td>${sousTotal}‚Ç¨</td></tr>`;
          }).join("")}
        </tbody>
      </table>
    `;
    totalDiv.innerHTML = `${getTranslation('commandes.table.total') || 'Total'} : <span style='color:#10222e;'>${total.toFixed(2)}‚Ç¨</span>`;
  }
}

// Gestion du r√©capitulatif commande
updateCommandeDisplay();

document.getElementById("confirmer-commande").onclick = function () {
  const numeroCommande = "CMD" + Math.floor(100000 + Math.random() * 900000);
  const heureActuelle = new Date();
  const tempsPreparation = 35;
  const heureRetrait = new Date(heureActuelle.getTime() + tempsPreparation * 60000);
  const heureStr = heureRetrait.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  
  document.getElementById("contenu-commande").style.display = "none";
  document.getElementById("confirmation").innerHTML = `
    <div class='card shadow p-4 mb-4 text-center' style='max-width: 500px; margin: 40px auto; border: 2px solid #198754;'>
      <h3 class='mb-3' style='color:#198754;'>üõí ${getTranslation('commandes.order_confirmed') || 'Merci pour votre commande !'}</h3>
      <p class='mb-2'>${getTranslation('commandes.order_number') || 'Num√©ro de commande :'} <strong style='color:#10222e; font-size:1.2em;'>${numeroCommande}</strong></p>
      <p class='mb-2'>${getTranslation('commandes.ready_around') || 'Votre commande sera pr√™te aux alentours de'} <strong style='color:#10222e;'>${heureStr}</strong>.</p>
      <p class='mb-3'>${getTranslation('commandes.thank_you') || 'Conservez bien ce num√©ro pour le retrait.'}</p>
      <a href="index.html" class="btn btn-outline-success mt-2">${getTranslation('commandes.back_to_menu') || 'Retour √† l\'accueil'}</a>
    </div>
  `;
  document.getElementById("confirmation").style.display = "block";
  localStorage.removeItem("cart");
};

// Gestion du modal panier
function getCart() {
  return JSON.parse(localStorage.getItem('cart') || '[]');
}
function setCart(cart) {
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
}
function updateCartCount() {
  const cart = getCart();
  const el = document.getElementById('cart-count');
  if (el) el.textContent = cart.reduce((sum, item) => sum + item.qty, 0);
}
function renderCart() {
  const cart = getCart();
  const list = document.getElementById('cart-items');
  list.innerHTML = '';
  let total = 0;
  cart.forEach((item, idx) => {
    total += item.price * item.qty;
    const li = document.createElement('li');
    li.innerHTML = `
      <img src="${item.img}" width="40" style="vertical-align:middle;"> 
      ${item.name} x${item.qty} - ${(item.price * item.qty).toFixed(2)} ‚Ç¨
      <button class="btn-remove-cart" onclick="removeFromCart(${idx})">${getTranslation('modals.cart.remove') || 'Supprimer'}</button>
    `;
    list.appendChild(li);
  });
  document.getElementById('cart-total').textContent = total.toFixed(2);
}
function removeFromCart(idx) {
  const cart = getCart();
  cart.splice(idx, 1);
  setCart(cart);
  renderCart();
}

const openCartBtn = document.getElementById('open-cart');
if (openCartBtn) {
  openCartBtn.onclick = function(e) {
    e.preventDefault();
    document.getElementById('cart-modal').style.display = 'block';
    renderCart();
  };
}
const closeCartBtn = document.getElementById('close-cart');
if (closeCartBtn) {
  closeCartBtn.onclick = function() {
    document.getElementById('cart-modal').style.display = 'none';
  };
}
const clearCartBtn = document.getElementById('clear-cart');
if (clearCartBtn) {
  clearCartBtn.onclick = function() {
    setCart([]);
    renderCart();
  };
}
const validateCartBtn = document.getElementById('validate-cart');
if (validateCartBtn) {
  validateCartBtn.onclick = function() {
    window.location.href = 'Commandes.html';
  };
}

updateCartCount();
</script>

<!-- Footer -->
<div class="footer-clean bg-light pt-4">
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-sm-4 col-md-3 item">
          <h3 data-translate="footer.services">Services</h3>
          <ul>
            <li><a href="menu.html" data-translate="nav.menu">Menu</a></li>
            <li><a href="Contact.html" data-translate="footer.events">√âv√®nements</a></li>
            <li><a href="Contact.html" data-translate="footer.special_orders">Commandes sp√©ciales</a></li>
          </ul>
        </div>
        <div class="col-sm-4 col-md-3 item">
          <h3 data-translate="footer.about">About</h3>
          <ul>
            <li><a href="apropos.html" data-translate="footer.company">Company</a></li>
            <li><a href="apropos.html" data-translate="footer.team">Team</a></li>
            <li><a href="apropos.html" data-translate="footer.legacy">Legacy</a></li>
          </ul>
        </div>
        <div class="col-sm-4 col-md-3 item">
          <h3 data-translate="footer.contact">Contact</h3>
          <ul>
            <li><a href="Contact.html" data-translate="footer.contact_us">Nous contacter</a></li>
            <li><a href="Contact.html" data-translate="footer.join_us">Nous rejoindre</a></li>
            <li><a href="apropos.html" data-translate="footer.find_us">Nous trouver</a></li>
          </ul>
        </div>
        <div class="col-lg-3 item social text-center">
          <a href="#"><img src="images/FB.webp" alt="Facebook" class="footer-social-logo"></a>
          <a href="#"><img src="images/twitter.png" alt="Twitter" class="footer-social-logo"></a>
          <a href="#"><img src="images/snapchat.webp" alt="Snapchat" class="footer-social-logo"></a>
          <a href="#"><img src="images/insta.png" alt="Instagram" class="footer-social-logo"></a>
          <p class="copyright mt-2" data-translate="footer.copyright">Bun'Deal ¬© 2025</p>
        </div>
      </div>
    </div>
  </footer>
</div>
<script src="burger-menu.js"></script>
</body>
</html>